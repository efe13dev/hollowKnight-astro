---
import ShadowModal from "./ShadowModal.astro";
---

<section
  id="historia"
  class="story py-16 px-4 bg-gradient-to-b from-black/80 via-[#18192b] to-[#18192b] relative overflow-hidden"
>
  <!-- Interactive Timeline -->
  <div class="timeline-container max-w-4xl mx-auto mb-16 fade-in">
    <div class="timeline flex justify-between items-center relative">
      <div
        class="timeline-line absolute h-1 bg-gradient-to-r from-[var(--secondary-color)] to-[var(--accent-color)] top-1/2 -translate-y-1/2 w-full"
      >
      </div>

      <div
        class="timeline-point relative z-10 cursor-pointer glow-hover"
        data-era="past"
        onclick="showEraContent('past', event)"
      >
        <div
          class="w-4 h-4 bg-[var(--accent-color)] rounded-full border-4 border-[var(--card-bg)] shadow-lg"
        >
        </div>
        <div
          class="absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap"
        >
          <span class="text-xs text-white bg-[var(--card-bg)] px-2 py-1 rounded"
            >Pasado</span
          >
        </div>
      </div>

      <div
        class="timeline-point relative z-10 cursor-pointer glow-hover"
        data-era="present"
        onclick="showEraContent('present', event)"
      >
        <div
          class="w-4 h-4 bg-[var(--secondary-color)] rounded-full border-4 border-[var(--card-bg)] shadow-lg"
        >
        </div>
        <div
          class="absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap"
        >
          <span class="text-xs text-white bg-[var(--card-bg)] px-2 py-1 rounded"
            >Presente</span
          >
        </div>
      </div>

      <div
        class="timeline-point relative z-10 cursor-pointer glow-hover"
        data-era="future"
        onclick="showEraContent('future', event)"
      >
        <div
          class="w-4 h-4 bg-[var(--accent-color)] rounded-full border-4 border-[var(--card-bg)] shadow-lg"
        >
        </div>
        <div
          class="absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap"
        >
          <span class="text-xs text-white bg-[var(--card-bg)] px-2 py-1 rounded"
            >Futuro</span
          >
        </div>
      </div>
    </div>
  </div>

  <h2
    class="text-center text-3xl md:text-4xl lg:text-5xl font-cinzel font-bold mb-20 uppercase tracking-widest text-white drop-shadow-[0_0_10px_rgba(138,43,226,0.5)] relative inline-block left-1/2 -translate-x-1/2 fade-in glitch"
    data-text="La Leyenda de Hallownest"
  >
    La Leyenda de Hallownest
    <span
      class="block absolute left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-[var(--accent-color)] to-transparent bottom-[-15px]"
    ></span>
    <span
      class="block absolute left-[16.666%] w-4/6 h-0.5 bg-gradient-to-r from-transparent via-[var(--accent-color)] to-transparent bottom-[-20px] opacity-70"
    ></span>
  </h2>

  <div
    id="era-content"
    class="story-content max-w-6xl mx-auto grid md:grid-cols-2 gap-24 lg:gap-28 items-center relative z-10"
  >
    <div
      class="story-text text-lg leading-relaxed relative p-10 rounded-xl bg-[rgba(20,20,30,0.6)] shadow-xl border border-white/10 backdrop-blur fade-in slide-in-left"
    >
      <p class="mb-8 pl-2 text-white/90 text-pretty relative">
        <span
          class="first-letter float-left text-6xl md:text-7xl font-bold mr-2 mt-1 mb-[-0.1em] text-[var(--accent-color)] drop-shadow-[0_0_15px_rgba(138,43,226,0.7)] font-cinzel bg-gradient-to-br from-[#8a2be2] to-[#00bfff] bg-clip-text text-transparent relative z-10"
          >B</span
        >
        ajo el pueblo abandonado de Dirtmouth se extienden las ruinas de Hallownest,
        un otrora próspero reino de insectos que yace en ruinas tras una misteriosa
        plaga. Lo que una vez fue una civilización floreciente bajo el gobierno del
        Rey Pálido, ahora es un laberinto de túneles abandonados y ciudades en ruinas,
        habitado por criaturas corrompidas por una fuerza antigua conocida como la
        Infección.
      </p>
      <p class="pl-2 text-white/90 text-pretty relative">
        <span
          class="first-letter float-left text-6xl md:text-7xl font-bold mr-2 mt-1 mb-[-0.1em] text-[var(--accent-color)] drop-shadow-[0_0_15px_rgba(138,43,226,0.7)] font-cinzel bg-gradient-to-br from-[#8a2be2] to-[#00bfff] bg-clip-text text-transparent relative z-10"
          >C</span
        >
        omo el Caballero, un misterioso viajero sin nombre, te adentrarás en las
        profundidades de este reino olvidado. A medida que explores, descubrirás
        la trágica historia de Hallownest, sus gobernantes caídos y el destino que
        aguarda a quienes se atreven a desafiar la maldición que consume el reino.
        Con cada paso, te enfrentarás a los horrores de la Infección mientras buscas
        respuestas sobre tu propio origen y propósito en este mundo en ruinas.
      </p>
    </div>
    <div
      class="story-image flex justify-center items-center py-8 fade-in slide-in-right"
    >
      <img
        src="/img/shadow.png"
        alt="Reino de Hallownest"
        id="shadow-img"
        class="w-4/5 max-w-lg mx-auto drop-shadow-xl hover:drop-shadow-[0_0_30px_rgba(255,255,255,0.6)] cursor-pointer transition duration-700 ease-in-out glow-hover parallax"
        data-speed="0.3"
      />
    </div>
  </div>

  <div id="shadow-modal-wrapper">
    <ShadowModal />
  </div>
  <script is:inline>
    // Timeline content switching
    const eraContent = {
      past: {
        title: "El Origen de la Plaga",
        text1:
          "Hace mucho tiempo, Hallownest era un próspero reino bajo el sabio gobierno del Rey Pálido y la Reina Herrah. Los insectos vivían en armonía, construyendo ciudades magníficas y desarrollando una cultura rica.",
        text2:
          "Pero algo cambió. Una fuerza extraña y corruptora comenzó a extenderse por las profundidades. Los sabios la llamaron 'La Radiancia' - una luz cegadora que prometía unidad pero traía locura.",
        image: "/img/202310192349115_5.webp",
      },
      present: {
        title: "La Caída del Reino",
        text1:
          "Bajo el pueblo abandonado de Dirtmouth se extienden las ruinas de Hallownest, un otrora próspero reino de insectos que yace en ruinas tras una misteriosa plaga.",
        text2:
          "Como el Caballero, un misterioso viajero sin nombre, te adentrarás en las profundidades de este reino olvidado. A medida que explores, descubrirás la trágica historia de Hallownest.",
        image: "/img/shadow.png",
      },
      future: {
        title: "La Esperanza de Renacimiento",
        text1:
          "A pesar de la corrupción, hay esperanza. Antiguas profecías hablan de un portador de luz que podrá purificar la Radiancia y restaurar el equilibrio.",
        text2:
          "El futuro de Hallownest depende de aquellos valientes que se atreven a desafiar la oscuridad. Con cada enemigo vencido y cada secreto descubierto, el reino se acerca un paso más a la redención.",
        image: "/img/hornet.webp",
      },
    };

    function showEraContent(era, event) {
      const content = eraContent[era];
      const container = document.getElementById("era-content");

      // Update timeline points
      document.querySelectorAll(".timeline-point").forEach((point) => {
        const pointEra = point.dataset.era;
        const dot = point.querySelector(".w-4");
        if (pointEra === era) {
          dot.classList.add("ring-4", "ring-[var(--accent-color)]");
          dot.classList.remove(
            "bg-[var(--accent-color)]",
            "bg-[var(--secondary-color)]",
          );
          dot.classList.add("bg-white");
        } else {
          dot.classList.remove(
            "ring-4",
            "ring-[var(--accent-color)]",
            "bg-white",
          );
          dot.classList.add(
            pointEra === "present"
              ? "bg-[var(--secondary-color)]"
              : "bg-[var(--accent-color)]",
          );
        }
      });

      // Fade out current content
      container.style.opacity = "0";

      setTimeout(() => {
        // Update content with animation
        container.innerHTML = `
          <div class="story-text text-lg leading-relaxed relative p-10 rounded-xl bg-[rgba(20,20,30,0.6)] shadow-xl border border-white/10 backdrop-blur fade-in slide-in-left">
            <h3 class="text-2xl font-bold mb-6 text-[var(--accent-color)] font-cinzel">${content.title}</h3>
            <p class="mb-8 pl-2 text-white/90 text-pretty relative">
              <span class="first-letter float-left text-6xl md:text-7xl font-bold mr-2 mt-1 mb-[-0.1em] text-[var(--accent-color)] drop-shadow-[0_0_15px_rgba(138,43,226,0.7)] font-cinzel bg-gradient-to-br from-[#8a2be2] to-[#00bfff] bg-clip-text text-transparent relative z-10">B</span>
              ${content.text1}
            </p>
            <p class="pl-2 text-white/90 text-pretty relative">
              <span class="first-letter float-left text-6xl md:text-7xl font-bold mr-2 mt-1 mb-[-0.1em] text-[var(--accent-color)] drop-shadow-[0_0_15px_rgba(138,43,226,0.7)] font-cinzel bg-gradient-to-br from-[#8a2be2] to-[#00bfff] bg-clip-text text-transparent relative z-10">C</span>
              ${content.text2}
            </p>
          </div>
          <div class="story-image flex justify-center items-center py-8 fade-in slide-in-right">
            <img src="${content.image}" alt="${content.title}" class="w-4/5 max-w-lg mx-auto drop-shadow-xl hover:drop-shadow-[0_0_30px_rgba(255,255,255,0.6)] cursor-pointer transition duration-700 ease-in-out glow-hover parallax" data-speed="0.3" />
          </div>
        `;
        container.style.opacity = "1";
      }, 300);

      // Add celebration particles
      for (let i = 0; i < 15; i++) {
        setTimeout(() => {
          const rect = event.target.getBoundingClientRect();
          createParticle(
            rect.left + rect.width / 2,
            rect.top + rect.height / 2,
          );
        }, i * 30);
      }
    }

    // Fade-in de la sombra
    window.addEventListener("load", function () {
      setTimeout(function () {
        const shadowImgEl = document.getElementById("shadow-img");
        if (shadowImgEl) shadowImgEl.style.opacity = "1";
      }, 4000);
    });

    // Modal mostrar/ocultar
    document.addEventListener("DOMContentLoaded", function () {
      const shadowImg = document.getElementById("shadow-img");
      const modal = document.getElementById("shadow-modal");
      const closeBtn = document.getElementById("close-shadow-modal");

      if (shadowImg && modal) {
        shadowImg.addEventListener("click", () => {
          modal.classList.add("active", "opacity-100", "pointer-events-auto");
          modal.classList.remove("opacity-0", "pointer-events-none");
        });
      }
      if (closeBtn && modal) {
        closeBtn.addEventListener("click", () => {
          modal.classList.remove(
            "active",
            "opacity-100",
            "pointer-events-auto",
          );
          modal.classList.add("opacity-0", "pointer-events-none");
        });
      }
      // Cerrar al hacer click fuera del modal
      if (modal) {
        modal.addEventListener("click", function (e) {
          if (e.target.id === "shadow-modal") {
            modal.classList.remove(
              "active",
              "opacity-100",
              "pointer-events-auto",
            );
            modal.classList.add("opacity-0", "pointer-events-none");
          }
        });
      }
    });
  </script>
</section>
